## 測試
下載pre-build [image](https://www.96boards.org/documentation/consumer/ultra96/ultra96-v2/downloads/linux.md.html)

## 事前準備
1. 安裝docker ubuntu22.04
```
docker build \
  --build-arg USER_UID=$(id -u) \
  --build-arg USER_GID=$(id -g) \
  -t my-petalinux:20.04 .
```

```
docker run -it \
  --name petalinux_lab \
  -v /home/itri2004/workspace/petalinux_docker:/home/pluser/workspace \
  -w /home/pluser/workspace \
  my-petalinux:20.04
```
2. petalinux 2024.2
3. 下載sstate ＆ download (amd download embedded software) [link](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools.html)
![download](./pic/sstate.png)
4. 下載bsp [link](https://www.avnet.com/americas/products/avnet-boards/avnet-board-families/ultra96-v2/)
### 在docker中安裝petalinux
```
chmod +x petalinux-v2024.2-final-installer.run
./petalinux-v20xx.xx-final-installer.run --dir ./tools

source /home/pluser/petalinux/settings.sh
```
### 進出docker
```
docker ps -a

docker start <container_name>

docker exec -it <container_name> bash

source /home/pluser/petalinux/settings.sh
```

### build project

petalinux-create -t project -s <bsp_file> -n test_project
petalinux-build 2>&1 | tee build.log
### petalinux-config
petalinux-config --get-hw-description <.xsa path>
- xsa在project hardware中

/home/pluser/workspace/offline/aarch64... 

### 燒錄
取消掛載
sudo umount /dev/sda1
sudo umount /dev/sda2
格式化
sudo mkfs.vfat -F 32 -n BOOT /dev/sda1
建立掛載點
sudo mkdir -p /mnt/sd_boot
sudo mount /dev/sda1 /mnt/sd_boot
複製image
cd ~/work/test_project/images/linux/
sudo cp BOOT.BIN boot.scr image.ub /mnt/sd_boot/
檢查並卸載
ls /mnt/sd_boot/  # 確認有看到三個檔案
sudo umount /mnt/sd_boot
燒錄
sudo umount /dev/sda2
sudo dd if=rootfs.ext4 of=/dev/sda2 bs=4M status=progress
sync

## 清除build
petalinux-build -x mrproper
rm -rf build/
rm -rf components/

petalinux-config

## xsct
source /tools/Xilinx/Vitis/2023.2/settings64.sh

xsct

connect

targets

## 理解
bsp -> 幫你功能開好 沒有bsp照樣能開只是功能需要自己加

xsa -> vivado產生 利用petalinux-config設定 並build 純xsa是沒有任何功能需要開啟kernel設定

ps->Linux端

pl->FPGA

## xsa錯誤

如果 PC 在 0xfffc0000 ~ 0xfffdffff 區間：

    代表卡在 OCM (On-Chip Memory)，也就是 FSBL 階段。

    這表示 FSBL 雖然載入了 Bitstream，但在初始化其他硬體 (如 DDR 或 PMU handoff) 時當機了。

    解法：檢查 DDR 設定 (XSA 記憶體參數錯誤) 或 PMUFW 缺失。

如果 PC 在 0x00000000 ~ 0x80000000 (DDR 範圍)：

    代表已經執行到 U-Boot 或 Linux Kernel 了！

    結論：系統活著，只是 UART 沒畫面。

    解法：回到第 1 點和第 2 點，檢查 Vivado UART 腳位和 Baud Rate (是否誤設為 9600 或其他數值，標準是 115200)。